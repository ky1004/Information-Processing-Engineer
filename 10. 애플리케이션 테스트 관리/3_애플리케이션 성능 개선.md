# 애플리케이션 테스트 관리

> ## 3. 애플리케이션 성능 개선

<br>

> ### 1) 애플리케이션 성능 분석

- 애플리케이션 성능 측정 지표
  - 처리량
    - 애플리케이션이 주어진 시간에 처리할 수 있는 트랜잭션의 수
  - 응답 시간
    - 사용자 입력이 끝난 후, 애플리케이션의 응답 출력이 개시될 때까지의 시간
  - 경과 시간
    - 애플리케이션에 사용자가 요구를 입력한 시점부터 트랜잭션을 처리 후 그 결과의 출력이 완료될 때까지 걸리는 시간
  - 자원 사용률
    - 애플리케이션이 트랜잭션을 처리하는 동안 사용하는 CPU 사용량, 메모리 사용량, 네트워크 사용량
- 애플리케이션 성능 저하 원인
  - 데이터베이스 / 내부로직 / 외부 호출 / 잘못된 환경설정 / 네트워크 문제 등으로 야기
- 데이터베이스 관련 문제
  - 데이터베이스 락
    - 대량의 데이터 조회, 과도한 업데이트, 인덱스 생성 시 발생
    - 요청한 작업은 Lock의 해제 시까지 대기하거나 타임아웃
  - 불필요한 데이터베이스 패치
    - 실제 필요한 데이터보다 많은 대량의 데이터 요청이 들어올 경우
    - 결과 세트에서 마지막 위치로 커서를 옮기는 작업이 빈번한 경우
    - 위 두가지 상황에 응답시간 저하 현상 발생
  - 연결 누수
    - DB 연결과 관련한 JDBC 객체를 사용 후 종료하지 않을 경우 발생
  - 부적절한 커넥션 풀 크기
    - 너무 작거나 크게 설정한 경우 성능 저하 현상이 발생할 가능성 존재
  - 확정(Commit)관련
    - 트랜잭션이 확정되지 않고 커넥션 풀에 반환될 때 성능 저하 가능성 존재
    - 잘못 작성된 코드로 인해 불필요한 확정이 자주 발생하는 경우 성능 저하 가능성 존재
- 내부 로직 문제
  - 웹 애플리케이션의 인터넷 접속 불량
  - 특정 파일의 업로드, 다운로드로 인한 성능 저하
  - 정상적으로 처리되지 않은 오류 처리로 인한 성능 저하
- 외부 호출 문제
  - 임의의 트랜잭션이 수행되는 동안 외부 트랜잭션(외부 호출)이 장시간 수행되거나, 타임아웃이 일어나는 경우 성능 저하 현상이 발생 가능
- 잘못된 환경설정 문제
  - 스레드 풀(Thread Pool), 힙 메모리(Heap Memory)의 크기를 너무 작게 설정하면 Heap Memory Full 현상 발생으로 성능 저하 가능성 존재
- 네트워크 장비 문제

  - 라우터, L4스위치 등 네트워크 관련 장비 간 데이터 전송 실패 또는 전송 지연에 따른 데이터 손실 발생 시 애플리케이션의 성능 저하 또는 장애 발생 가능성 존재

- 성능 테스트 케이스 작성
  - 목표값 설정 >> 측정 항목 기술 >> 테스트 시나리오 >> 사전 확인사항
- 성능 테스트 수행 절차
  - 성능 테스트 도구 설치
  - 테스트 환경 설정
  - 시나리오 생성
  - 성능 테스트 실행 및 모니터링

<br>

> ### 2) 애플리케이션 성능 개선

- 배드 코드의 개념
  - 다른 개발자가 로직을 이해하기 어렵게 작성된 코드
- 배드 코드 사례
  - 외계인 코드 : 아주 오래되거나 참고문서, 개발자가 없어 유지보수 작업이 아주 어려운 코드
  - 스파게티 코드 : 소스코드가 복잡하게 얽힌 모습을 비유한 표현
  - 알 수 없는 변수명 : 변수나 메서드에 대한 이름 정의를 알 수 없는 코드
  - 로직 중복 : 동일한 처리 로직이 중복되게 작성된 코드
- 배드 코드의 유형
  - 오염 : 비즈니스 기능을 수행하지 못하는 많은 컴포넌트 존재
  - 문서 부족 : 현재 코드와 문서가 일치하지 않고 수정과 변경을 위한 도메인 지식은 크게 증가하지만 개발자의 지식부족 초래
  - 의미없는 이름 : 함수, 클래스, 컴포넌트 이름들이 명확한 의미를 갖지 못하거나 실제 작동과 불일치
  - 높은 결합도 : 클래스와 컴포넌트 간의 흐름이 복잡하게 연결
  - 아키텍처 침식 : 아키텍처가 더 이상 구별되지 않고 여러 솔루션으로 이루어져 변형들로 인해 시스템 품질이 떨어짐
- 클린코드 개념
  - 잘 작성되어 가독성,단순성이 좋고 의존성을 줄이고 중복을 최소화하여 깔끔하게 잘 정리된 코드
- 클린코드 작성 원칙
  - 가독성 : 이해하기 쉬운 용어 사용
  - 단순성 : 한번에 한가지 처리만 수행. 최소 단위로 분리
  - 의존성 최소 : 영향도를 최소화하여 코드의 변경이 다른 부분에 영향이 없게 작성
  - 중복성 제거 : 중복 코드를 제거하고 공통된 코드 사용
  - 추상화 : 클래스,매서드,함수에 대한 동일 수준의 추상화 구현. 상세 내용은 하위클래스,매서드,함수 에서 구현
- 소스 코드 최적화 기법의 유형
  - 의미 있는 이름, 간결하고 명확한 주석, 보기 좋은 배치, 작은 함수, 읽기 쉬운 제어 흐름, 오류 처리, 클래스 분할 배치, 느슨한 결합(Loosely Coupled) 기법 적용, 코딩 형식 기법 적용
- 소스 코드 품질 분석 개념
  - 코딩스타일, 코딩 표준, 코드의 복잡도, 코드 내에 존재하는 메모리 누수 현황, 스레드의 결함 등을 발견하기 위한 활동
- 소스 코드 품질 분석 도구 유형
  - 정적 분석도구
    - 프로그램을 실행하지 않고 코드 리뷰를 함
    - pmd, cppcheck, SonarQube, checkstyle, ccm, cobertura
  - 동적 분석도구
    - 프로그램을 실행하여 메모리 누수 현황이나 스레드의 결함을 분석함
    - Avalanche, Valgrind
- 애플리케이션 성능 개선 방안

  - 소스 코드 최적화 기법 적용 : 의존성 최소화
  - 아키텍처 조정 : 팩토리메서드 패턴
  - 프로그램 호출 순서 적용
  - 소스코드 품질 분석 도구 활용
  - 리팩토링

- 리팩토링의 개념
  - 소프트웨어 모듈의 외부적 기능은 수정하지 않고 내부적으로 구조, 관계 등을 단순화하여 소프트웨어의 유지보수성을 향상시키는 기법
- 리팩토링의 목적
  - 유지보수성 향상 : 복잡한 코드의 단순화, 소스의 가독성 향상
  - 유연한 시스템 : 소프트웨어 요구사항 변경에 유연한 대응
  - 생산성 향상 : 정제 및 최적화된 소스의 재사용
  - 품질 향상 : 소프트웨어 오류발견이 용이하여 품질향상
